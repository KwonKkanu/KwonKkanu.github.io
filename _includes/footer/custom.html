<script>
(function() {
  const sidebar = document.querySelector('.sidebar');
  if (!sidebar) return;

  sidebar.querySelectorAll('.nav__list li').forEach(function(li){
    const sub = Array.from(li.children).find(el => el.tagName === 'UL');
    if (!sub) return;

    li.classList.add('has-children');

    const label = Array.from(li.children).find(el =>
      el.tagName === 'A' || el.tagName === 'SPAN'
    );
    if (!label) return;

    const indicator = document.createElement('span');
    indicator.className = 'toggle';
    indicator.setAttribute('aria-hidden','true');
    indicator.textContent = '▸';
    label.prepend(indicator);

    li.classList.remove('open'); // 기본 접힘

    label.addEventListener('click', function(e){
      e.preventDefault(); // 부모는 페이지 이동 막고 토글만 수행
      li.classList.toggle('open');
    });
  });

  // 현재 페이지가 children 안에 있으면 자동으로 펼치기
  const current = sidebar.querySelector('.nav__list a[href="'+ location.pathname +'"]');
  if (current) {
    let p = current.parentElement;
    while (p && p !== sidebar) {
      if (p.matches && p.matches('li.has-children')) p.classList.add('open');
      p = p.parentElement;
    }
  }
})();
</script>
